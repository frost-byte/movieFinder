
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Fresh Tomatoes!</title>

	<!-- Trailer Addict -->
	<link rel="stylesheet" type="text/css" href="//cdn.traileraddict.com/css/rembed.css">
	
    <!-- Bootstrap 3 -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap-theme.min.css">
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <style type="text/css" media="screen">
        body {
            padding-top: 80px;
        }
        #trailer .modal-dialog {
            margin-top: 200px;
            width: 640px;
            height: 480px;
        }
		#search .modal-dialog {
			margin-top: 150px;
			width: 75%;
			height: 480px;
		}
		#search-container .panel {
			text-align: center;
		}
		.search-table {
			margin-left: auto;
			margin-right: auto;
		}
		.search-table tr {
			text-align: left;
		}
		
		#movieInfo .modal-dialog {
			margin-top: 150px;
			width: 80%;
			height: 480px;
		}
		#movieInfo a.hanging-close img {
			height: initial;
			width: initial;
			padding: 1.5em 1.5em;
		}
		.movie-search-item:hover {
            background-color: #EEE;
            cursor: pointer;
		}
		#movieInfo img{
			vertical-align:top;
			height: 360px;
			width: auto;
		}
		
		.view-table img{
			width: 80%;
		}
		#view-description{
			padding-right: 50px;
			padding-left: 50px;
		}
		#view-add{
			padding-left: 50px;
		}
        .hanging-close {
            position: absolute;
            top: -12px;
            right: -12px;
            z-index: 9001;
        }
        #trailer-video {
            width: 100%;
            height: 100%;
        }
        .movie-tile {
            margin-bottom: 20px;
            padding-top: 20px;
        }
        .movie-tile:hover {
            background-color: #EEE;
            cursor: pointer;
        }
        .scale-media {
            padding-bottom: 56.25%;
            position: relative;
        }
        .scale-media iframe {
            border: none;
            height: 100%;
            position: absolute;
            width: 100%;
            left: 0;
            top: 0;
            background-color: white;
        }
		.panel {
			border: none;
		}
		#movie-info-container {
			margin-left: auto;
			margin-right: auto;
		}

		.modal-content {
			margin-left: auto;
			margin-right: auto;
		}	
		@media (min-width: 900px){
			.modal-content{
				width: 890px;
			}
		}
    </style>
    <script type="text/javascript" charset="utf-8">
        // Pause the video when the modal is closed
        $(document).on('click', '.hanging-close, .modal-backdrop, .modal', function (event) {
            // Remove the src so the player itself gets removed, as this is the only
            // reliable way to ensure the video stops playing in IE
            $("#trailer-video-container").empty();
        });
		
		// Display a Panel containing information about a movie that was selected from the Search Results Panel.
		$(document).on('click', '.movie-search-item', function (event){
			// Send a POST request to the Server to generate the Movie Info Panel
			$('#movie-info-container').empty();
			
			var movie_title = $('#searchText').val();
			var data = { 
				title: $(this).attr('data-movie-title'),
				imdb_id: $(this).attr('data-movie-imdb-id'),
				poster_url: $(this).attr('data-movie-poster-url'),
				year: $(this).attr('data-movie-year')
			};
			
			$.ajax({
				url: '/view',
				data: JSON.stringify(data),
				datatype: 'json',
				contentType: "application/json; charset=utf-8",
				type: 'POST',
				success: function(response){
					$("#search").modal('hide');
					$("#movie-info-container").empty().append(response);
					$("#movieInfo").modal({
						"backdrop" : "true",
						"keyboard" : "true",
						"show" : "true"
					});
				},
				error: function(error){
					console.log(error);
				}
			});			
		});
		
		// The user clicks on the "Add to Favorites" button in the Movie Info View (which was created when they selected a movie from the search panel)
		$(document).on('click', '#view-add-to-favorites', function (event) {
			var data = { 
				title: $(this).attr('data-title'),
				trailer_url: $(this).attr('data-trailer-url'),
				poster_url: $(this).attr('data-poster-url')
			}
			
			$.ajax({
				url: '/add',
				data: JSON.stringify(data),
				datatype: 'json',
				contentType: "application/json; charset=utf-8",
				type: 'POST',
				success: function(response){
					$('#view-add-to-favorites').addClass('disabled');
					$('#view-add-to-favorites').removeAttr('data-toggle');
					$('#view-add-to-favorities').val("In Favorites");
					$('#movie-list-container').empty().append(response);
				},
				error: function(error){
					console.log(error);
				}
			});	
		});
		
		$(document).on('click', '#view-play-trailer, .movie-tile', function (event) {
			var trailerId = $(this).attr('data-trailer-url'); 
			$("#trailer-video-container").empty().append($("<iframe></iframe>", {
				'id' : 'trailer-video',
				'type': 'text-html',
				'src' : trailerId,
				'allowfullscreen' : 'true',
				'webkitallowfullscreen' : 'true', 
				'mozallowfullscreen' : 'true',
				'scrolling' : 'no',
				'frameborder': 0
			}));
		});	
		
		// Animate in the movies when the page loads
        $(document).ready(function () {
          $('.movie-tile').hide().first().show("fast", function showNext() {
            $(this).next("div").show("fast", showNext);
          });
        });
		
		// Submit a search query to find a movie by a title.
		function submitSearch(){
			var movie_title = $('#searchText').val();
			var data = { title: movie_title };
		
			$.ajax({
				url: '/search',
				data: JSON.stringify(data),
				datatype: 'json',
				contentType: "application/json; charset=utf-8",
				type: 'POST',
				success: function(response){
					//console.log(response);
					$("#search-container").empty().append(response);
					$("#search").modal({
						"backdrop" : "true",
						"keyboard" : "true",
						"show" : "true"
					});
				},
				error: function(error){
					console.log(error);
				}
			});
		}
		// Submit the Movie title in the search Text box when the submit button is clicked or enter is pressed when the text box has focus.
        $(document).on('keypress',"#searchText", function(event) {
			var keycode = (event.keyCode ? event.keyCode: event.which);
			
			// Test if the enter key was pressed
			if(keycode == '13') {
				// Submit the Search Results
				submitSearch();
			}
		});
		$(document).on('click',"#search-submit", submitSearch);
    </script>
</head>

  <body>
    <!-- Trailer Video Modal -->
    <div class="modal" id="trailer">
      <div class="modal-dialog">
        <div class="modal-content">
          <a href="#" class="hanging-close" data-dismiss="modal" aria-hidden="true">
            <img src="https://lh5.ggpht.com/v4-628SilF0HtHuHdu5EzxD7WRqOrrTIDi_MhEG6_qkNtUK5Wg7KPkofp_VJoF7RS2LhxwEFCO1ICHZlc-o_=s0#w=24&h=24"/>
          </a>
          <div class="scale-media" id="trailer-video-container">
          </div>
        </div>
      </div>
    </div>
	<!-- Search Modal -->
	<div class="modal" id="search">
		<div class="modal-dialog">
			<div class="modal-content">
				<a href="#" class="hanging-close" data-dismiss="modal" aria-hidden="true">
					<img src="https://lh5.ggpht.com/v4-628SilF0HtHuHdu5EzxD7WRqOrrTIDi_MhEG6_qkNtUK5Wg7KPkofp_VJoF7RS2LhxwEFCO1ICHZlc-o_=s0#w=24&h=24"/>
				</a>
				<div id="search-container">
				</div>
			</div>
		</div>
	</div>
	<!-- Movie Info Modal -->
	<div class="modal" id="movieInfo">
		<div class="modal-dialog">
			<div class="modal-content">
				<a href="#" class="hanging-close" data-dismiss="modal" aria-hidden="true">
					<img src="https://lh5.ggpht.com/v4-628SilF0HtHuHdu5EzxD7WRqOrrTIDi_MhEG6_qkNtUK5Wg7KPkofp_VJoF7RS2LhxwEFCO1ICHZlc-o_=s0#w=24&h=24"/>
				</a>
				<div id="movie-info-container">
				</div>
			</div>
		</div>
	</div>			
    <!-- Main Page Content -->
    <div class="container">
        <div class="navbar-header col-lg-6">
            <a class="navbar-brand" href="#">Fresh Tomatoes Movie Trailers</a>
        </div>
		<div class="row">
			<div class="col-lg-6">
				<div class="input-group input-group-lg">
					<span class="input-group-addon">
						<span class="glyphicon glyphicon-search"></span>
					</span>            
					<input type="text" id="searchText" class="form-control" placeholder="Search">
					<span class="input-group-btn">
						<button class="btn btn-default" id="search-submit" type="button">Submit</button>
					</span>
				</div><!-- /input-group -->      
			</div><!-- /col-lg-6 -->
		</div><!-- /row -->
	</div><!-- /Main Page Content container -->
	
	<!-- List of Tiles that represent Favorite Movies -->
	<div id="movie-list-container">
		{% if movieList %}
		<div class="container">
		{% for movie in movieList %}
			<div class="col-md-6 col-lg-4 movie-tile text-center" data-trailer-url="{{ movie.trailer_url }}" data-toggle="modal" data-target="#trailer">
				<img src="{{ movie.poster_image_url }}" width="220" height="342">
				<h2>{{ movie.title }}</h2>
			</div>
		{% endfor %}	
		</div>
		{% endif %}
	<div>
  </body>
</html>
